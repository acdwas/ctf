
from z3 import *
from pwn import *
import sys

v8 = 0x0b * 0x0b
a3 = 0x54

def fun_b():
    global v8
    v8 = -(0x0b * 0x0b)
    return v8

def fun_d():
    global v8
    v8 = 0x0b
    return v8

def fun_f():
    global v8
    v8 = (0x0b * 0x0b)
    return v8

def fun_l():
    global v8
    v8 = -1
    return v8

def fun_r():
    global v8
    v8 = 1
    return v8

def fun_u():
    global v8
    v8 = -0x0b
    return v8

def fun():
    global v8
    return v8

s = Solver()

a = [Int(f'a{i}') for i in range(28)]

for i in range(28):
    s.add(Or(a[i] == ord('b'), a[i] == ord('d'), a[i] == ord('f'), a[i] == ord('l'), a[i] == ord('r'), a[i] == ord('u')))

for i in range(28):
	a3 += If(a[i] == ord('b'), fun_b(), If(a[i] == ord('d'), fun_d(), If(a[i] == ord('f'), fun_f(), If(a[i] == ord('l'), fun_l(), 
		If(a[i] == ord('r'), fun_r(), If(a[i] == ord('u'), fun_u(), fun()))))))
    
	s.add(a3 > 0, a3 < 0x0b * 0x0b * 0x0b)
	s.add(Or(a3 == 84, a3 == 133, a3 == 134, a3 == 135, a3 == 136, a3 == 137, a3 == 141, a3 == 146, a3 == 152, a3 == 155, a3 == 156, 
	a3 == 157, a3 == 159, a3 == 160, a3 == 161, a3 == 162, a3 == 163, a3 == 166, a3 == 168, a3 == 174, a3 == 177, a3 == 178, a3 == 179, 
	a3 == 180, a3 == 181, a3 == 185, a3 == 188, a3 == 190, a3 == 192, a3 == 199, a3 == 200, a3 == 201, a3 == 203, a3 == 204, a3 == 205, 
	a3 == 206, a3 == 207, a3 == 210, a3 == 212, a3 == 214, a3 == 216, a3 == 221, a3 == 223, a3 == 224, a3 == 225, a3 == 226, a3 == 227, 
	a3 == 254, a3 == 262, a3 == 276, a3 == 278, a3 == 282, a3 == 320, a3 == 322, a3 == 328, a3 == 344, a3 == 375, a3 == 377, a3 == 379, 
	a3 == 380, a3 == 381, a3 == 383, a3 == 386, a3 == 388, a3 == 392, a3 == 397, a3 == 398, a3 == 399, a3 == 400, a3 == 401, a3 == 403, 
	a3 == 404, a3 == 405, a3 == 408, a3 == 410, a3 == 414, a3 == 419, a3 == 421, a3 == 423, a3 == 424, a3 == 425, a3 == 432, a3 == 434, 
	a3 == 441, a3 == 442, a3 == 443, a3 == 444, a3 == 445, a3 == 446, a3 == 447, a3 == 448, a3 == 449, a3 == 452, a3 == 454, a3 == 463, 
	a3 == 464, a3 == 465, a3 == 466, a3 == 467, a3 == 469, a3 == 496, a3 == 498, a3 == 502, a3 == 518, a3 == 520, a3 == 524, a3 == 540, 
	a3 == 542, a3 == 546, a3 == 562, a3 == 564, a3 == 566, a3 == 568, a3 == 586, a3 == 588, a3 == 590, a3 == 617, a3 == 619, a3 == 621, 
	a3 == 622, a3 == 623, a3 == 628, a3 == 630, a3 == 632, a3 == 639, a3 == 640, a3 == 641, a3 == 642, a3 == 643, a3 == 645, a3 == 646, 
	a3 == 647, a3 == 650, a3 == 652, a3 == 658, a3 == 661, a3 == 663, a3 == 667, a3 == 669, a3 == 683, a3 == 685, a3 == 686, a3 == 687, 
	a3 == 688, a3 == 689, a3 == 694, a3 == 698, a3 == 700, a3 == 705, a3 == 707, a3 == 709, a3 == 710, a3 == 711, a3 == 712, a3 == 713, 
	a3 == 738, a3 == 742, a3 == 760, a3 == 764, a3 == 782, a3 == 804, a3 == 806, a3 == 826, a3 == 830, a3 == 859, a3 == 860, a3 == 861, 
	a3 == 862, a3 == 863, a3 == 864, a3 == 865, a3 == 866, a3 == 867, a3 == 870, a3 == 872, a3 == 874, a3 == 881, a3 == 883, a3 == 885, 
	a3 == 886, a3 == 887, a3 == 889, a3 == 894, a3 == 896, a3 == 898, a3 == 900, a3 == 903, a3 == 904, a3 == 905, a3 == 906, a3 == 907, 
	a3 == 909, a3 == 911, a3 == 914, a3 == 918, a3 == 920, a3 == 922, a3 == 925, a3 == 927, a3 == 928, a3 == 929, a3 == 931, a3 == 932, 
	a3 == 933, a3 == 936, a3 == 938, a3 == 940, a3 == 944, a3 == 947, a3 == 949, a3 == 950, a3 == 951, a3 == 952, a3 == 953, a3 == 955, 
	a3 == 982, a3 == 1002, a3 == 1006, a3 == 1028, a3 == 1052, a3 == 1054, a3 == 1068, a3 == 1074, a3 == 1103, a3 == 1114, a3 == 1123, 
	a3 == 1124, a3 == 1125, a3 == 1127, a3 == 1128, a3 == 1129, a3 == 1149, a3 == 1150, a3 == 1151, a3 == 1167, a3 == 1168, a3 == 1169, 
	a3 == 1171, a3 == 1172, a3 == 1173, a3 == 1175, a3 == 1178, a3 == 1184, a3 == 1189, a3 == 1190, a3 == 1191, a3 == 1195, a3 == 1296))

s.add(a3 == 1296)

while s.check() == sat:
    m = s.model()

    w = ''
    for i in range(28):
        w += chr(m[a[i]].as_long())

    r = process('./chall', level='error')
    r.sendline(w)
    n = r.recv()
    if b'flag' in n:
        print(w)
        print(n)
        sys.exit()
    r.close()

    s.add(Or(a[0] != s.model()[a[0]],
        a[1] != s.model()[a[1]],
        a[2] != s.model()[a[2]],
        a[3] != s.model()[a[3]],
        a[4] != s.model()[a[4]],
        a[5] != s.model()[a[5]],
        a[6] != s.model()[a[6]],
        a[7] != s.model()[a[7]],
        a[8] != s.model()[a[8]],
        a[9] != s.model()[a[9]],
        a[10] != s.model()[a[10]],
        a[11] != s.model()[a[11]],
        a[12] != s.model()[a[12]],
        a[13] != s.model()[a[13]],
        a[14] != s.model()[a[14]],
        a[15] != s.model()[a[15]],
        a[16] != s.model()[a[16]],
        a[17] != s.model()[a[17]],
        a[18] != s.model()[a[18]],
        a[19] != s.model()[a[19]],
        a[20] != s.model()[a[20]],
        a[21] != s.model()[a[21]],
        a[22] != s.model()[a[22]],
        a[23] != s.model()[a[23]],
        a[24] != s.model()[a[24]],
        a[25] != s.model()[a[25]],
        a[26] != s.model()[a[26]],
        a[27] != s.model()[a[27]]
        ))

# frrffllffddllffrrffuubbrrfff
# :)
# flag{star_/_so_bright_/_car_/_site_-ppsu}